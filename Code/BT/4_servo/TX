#include <SoftwareSerial.h>

// pushbutton code 추가

#define front A0
#define side A1
#define delt A2
#define elbow A3
#define gripper A4

#define NUM_JOINT 5

#define pin_switch 7

#define upper_limit 180
#define lower_limit 0

SoftwareSerial BTSerial(2, 3);  // BTSerial(Rx, Tx)


void setup() {
  Serial.begin(9600);
  BTSerial.begin(38400);
  pinMode(pin_switch, INPUT_PULLUP);
}

void loop() {

  int val[NUM_JOINT] = { 0, 0, 0, 0, 0 };
  int state = digitalRead(pin_switch);

  if (state == 0) {  //;로도 해보기

    // Serial.println(state);
    int front_val = map(analogRead(front), 28, 830, 2, 178);  //서보모터 각도(0~180도)
    int side_val = map(analogRead(side), 28, 830, 2, 178);
    int delt_val = map(analogRead(delt), 28, 830, 2, 178);
    int elbow_val = map(analogRead(elbow), 28, 830, 2, 178);
    int gripper_val = map(analogRead(gripper), 28, 830, 2, 178);


//Lower limit 설정
if(front_val<lower_limit){
  front_val = lower_limit;
}
if(side_val<lower_limit){
  side_val = lower_limit;
}
 
 if(delt_val<lower_limit){
  delt_val = lower_limit;
}
 
 if(elbow_val<lower_limit){
  elbow_val = lower_limit;
}
 
 if(gripper_val<lower_limit){
  gripper_val = lower_limit;
}

if(front_val>upper_limit){
  front_val = upper_limit;
}
if(side_val<upper_limit){
  side_val = upper_limit;
}
 
 if(delt_val<upper_limit){
  delt_val = upper_limit;
}
 
 if(elbow_val<upper_limit){
  elbow_val = upper_limit;
}
 
 if(gripper_val<upper_limit){
  gripper_val = upper_limit;
}


 
    val[0] = front_val;
    val[1] = side_val;
    val[2] = elbow_val;
    val[3] = delt_val;
    val[4] = gripper_val;

    for (int i = 0; i < NUM_JOINT; i++) {
      // Serial.println(val[i]);
      BTSerial.write((byte)val[i]);
    }
    Serial.println(val[0]);
    // Serial.println(analogRead(front));
    delay(40);
  }
}
